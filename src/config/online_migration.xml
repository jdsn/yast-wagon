<?xml version="1.0"?>
<productDefines  xmlns="http://www.suse.com/1.0/yast2ns"
    xmlns:config="http://www.suse.com/1.0/configns">

<!-- This workflow is part of the yast2-wagon package -->

<!-- 
Work around for the text domain 
textdomain="online-migration"
-->
    <textdomain>online-migration</textdomain>

    <globals>
	<!-- Change to 'false' in production -->
	<debug_workflow config:type="boolean">true</debug_workflow>

	<default_subworkflow>manual</default_subworkflow>

	<subworkflows config:type="list">
	    <!--
		Simple workflow: Used when WAGON is called from applet
	    -->
	    <subworkflow>
		<name>running_by_applet</name>
		<modules config:type="list">
		    <module>welcome</module>
		    <module>update_online_mechanism</module>
		    <module>suse_register_workflow</module>
		    <!-- FIXME: replace with kickoff, rpmcopy ... -->
		    <module>fixme</module>
		    <module>suseconfig_after_update</module>
		    <module>suse_register_after_update</module>
		    <module>finished</module>
		</modules>
		<proposals config:type="list">
		    <proposal>wagon_proposal</proposal>
		</proposals>
	    </subworkflow>

	    <!--
		Manual workflow: Used when calling WAGON manually (Control center, ...)
		without params. It's later switched to one of 'custom_url' or 'suse_register'
		workflows, so it actually contains both.
	    -->
	    <subworkflow>
		<name>manual</name>
		<modules config:type="list">
		    <module>welcome</module>
		    <module>update_online_mechanism</module>
		    <!-- Workflow is switched after this module -->
		    <module>update_url_dialog</module>
		    <module>suse_register_workflow</module>
		    <module>wagon_custom_url</module>
		    <module>wagon_selfupdate_from_url</module>
		    <!-- FIXME: replace with kickoff, rpmcopy ... -->
		    <module>fixme</module>
		    <module>suseconfig_after_update</module>
		    <module>suse_register_after_update</module>
		    <module>finished</module>
		</modules>
		<proposals config:type="list">
		    <proposal>wagon_proposal</proposal>
		</proposals>
	    </subworkflow>

	    <!--
		manual + suse_register workflow: User selected 'Customer Center'
	    -->
	    <subworkflow>
		<name>manual_suse_register</name>
		<modules config:type="list">
		    <module>welcome</module>
		    <module>update_online_mechanism</module>
		    <!-- Workflow is switched after this module -->
		    <module>update_url_dialog</module>
		    <module>suse_register_workflow</module>
		    <!-- FIXME: replace with kickoff, rpmcopy ... -->
		    <module>fixme</module>
		    <module>suseconfig_after_update</module>
		    <module>suse_register_after_update</module>
		    <module>finished</module>
		</modules>
		<proposals config:type="list">
		    <proposal>wagon_proposal</proposal>
		</proposals>
	    </subworkflow>

	    <!--
		manual + custom_url workflow: User selected 'Custom URL'
	    -->
	    <subworkflow>
		<name>manual_custom_url</name>
		<modules config:type="list">
		    <module>welcome</module>
		    <module>update_online_mechanism</module>
		    <!-- Workflow is switched after this module -->
		    <module>update_url_dialog</module>
		    <module>wagon_custom_url</module>
		    <module>wagon_selfupdate_from_url</module>
		    <!-- FIXME: replace with kickoff, rpmcopy ... -->
		    <module>fixme</module>
		    <module>suseconfig_after_update</module>
		    <module>suse_register_after_update</module>
		    <module>finished</module>
		</modules>
		<proposals config:type="list">
		    <proposal>wagon_proposal</proposal>
		</proposals>
	    </subworkflow>

	    <!--
		PatchCD workflow: 'Custom URL' used directly
	    -->
	    <subworkflow>
		<name>PatchCD</name>
		<modules config:type="list">
		    <module>welcome</module>
		    <module>wagon_custom_url</module>
		    <module>wagon_selfupdate_from_url</module>
		    <!-- FIXME: replace with kickoff, rpmcopy ... -->
		    <module>fixme</module>
		    <module>suseconfig_after_update</module>
		    <module>suse_register_after_update</module>
		    <module>finished</module>
		</modules>
		<proposals config:type="list">
		    <proposal>wagon_proposal</proposal>
		</proposals>
	    </subworkflow>
	</subworkflows>
    </globals>

    <proposals config:type="list">
	<proposal>
	    <label>Distribution Upgrade Settings</label>
	    <mode>update</mode>
	    <stage>normal</stage>
	    <name>wagon_proposal</name>
	    <enable_skip>no</enable_skip>

	    <proposal_modules config:type="list">
		<proposal_module>add-on</proposal_module>
		<!--
		    FIXME: replace with new client for migration
		    <proposal_module>update</proposal_module>
		-->
		<proposal_module>packages</proposal_module>
		<proposal_module>backup</proposal_module>
	    </proposal_modules>
	</proposal>
    </proposals>

    <workflows config:type="list">

	<workflow>
	    <defaults>
		<archs>all</archs>
		<enable_back>yes</enable_back>
		<enable_next>yes</enable_next>
	    </defaults>

	    <label>Online Migration</label>
	    <!-- Mode: update, Stage: normal -->
	    <mode>update</mode>
	    <stage>normal</stage>

	    <modules config:type="list">
		<module>
		    <heading>yes</heading>
		    <label>Preparation</label>
		</module>

		<!-- A welcome screen that informs user what is it all about. -->
		<module>
		    <label>Welcome</label>
		    <name>welcome</name>
		    <execute>welcome_in_wagon</execute>
		    <enable_back>no</enable_back>
		</module>

		<!-- Update itself, Add new 'migration-product' -->
		<module>
		    <label>Renew Update Stack</label>
		    <name>update_online_mechanism</name>
		    <execute>wagon_selfupdate</execute>
		</module>

		<!-- Offer several possibilities how to set update repository URL -->
		<module>
		    <label>Renew Update Stack</label>
		    <name>update_url_dialog</name>
		    <execute>wagon_update_url</execute>
		</module>

		<!--
		    Option A:
		    (*) Automatically selected when running via applet
		    (*) Offered in wagon_update_url if not running via applet
		-->
		<module>
		    <label>Renew Update Stack</label>
		    <name>suse_register_workflow</name>
		    <execute>inst_suse_register</execute>
		</module>

		<!--
		    Option B:
		    (*) Offered in wagon_update_url if not running via applet
		-->
		<module>
		    <label>Renew Update Stack</label>
		    <name>wagon_custom_url</name>
		    <execute>wagon_custom_url</execute>
		</module>

		<!--
		    Option B:
		    Follows the wagon_ownurl
		-->
		<module>
		    <label>Renew Update Stack</label>
		    <name>wagon_selfupdate_from_url</name>
		    <execute>wagon_selfupdate</execute>
		</module>

		<module>
		    <heading>yes</heading>
		    <label>Migration</label>
		</module>

		<!--
		    Use migration URL to Update/Upgrade the running system
		    This will replace the 'migration-product' with 'new-product'
		-->
		<!-- FIXME: reinit sources? We've got some new ... -->
		<module>
		    <label>Update</label>
		    <name>wagon_proposal</name>
		    <execute>inst_proposal</execute>
		    <proposal>wagon_proposal</proposal>
		</module>

		<!-- FIXME: inst_kickoff, inst_rpmcopy? -->
		<module>
		    <label>Update</label>
		    <name>fixme</name>
		    <execute>fixme</execute>
		</module>

		<module>
		    <label>Update</label>
		    <name>suseconfig_after_update</name>
		    <execute>inst_suseconfig</execute>
		</module>

		<!-- Register the 'new-product' -->
		<module>
		    <label>Registration</label>
		    <name>suse_register_after_update</name>
		    <execute>inst_suse_register</execute>
		</module>

		<!-- Congratulate, Inform user to reboot etc. -->
		<module>
		    <label>Finished</label>
		    <name>finished</name>
		    <execute>inst_congratulate</execute>
		</module>
	    </modules>
	</workflow>

    </workflows>

</productDefines>

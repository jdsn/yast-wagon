<?xml version="1.0"?>
<productDefines  xmlns="http://www.suse.com/1.0/yast2ns"
    xmlns:config="http://www.suse.com/1.0/configns">

<!-- This workflow is part of the yast2-wagon package -->

<!-- 
Work around for the text domain 
textdomain="online-migration"
-->
    <textdomain>online-migration</textdomain>

    <proposals config:type="list">
	<proposal>
	    <label>Distribution Upgrade Settings</label>
	    <mode>update</mode>
	    <stage>normal</stage>
	    <name>wagon_proposal</name>
	    <enable_skip>no</enable_skip>

	    <proposal_modules config:type="list">
		<proposal_module>add-on</proposal_module>
		<proposal_module>update</proposal_module>
		<proposal_module>packages</proposal_module>
		<proposal_module>backup</proposal_module>
	    </proposal_modules>
	</proposal>
    </proposals>

    <workflows config:type="list">

	<workflow>
	    <defaults>
		<archs>all</archs>
		<enable_back>yes</enable_back>
		<enable_next>yes</enable_next>
	    </defaults>

	    <label>Online Migration</label>
	    <!-- Mode: update, Stage: normal -->
	    <mode>update</mode>
	    <stage>normal</stage>

	    <modules config:type="list">
		<!-- Some welcome screen to inform user what is it all about -->
		<module>
		    <label>Welcome</label>
		    <name>welcome</name>
		    <execute>welcome_in_wagon</execute>
		    <enable_back>no</enable_back>
		</module>

		<!-- Update itself, Add new 'migration-product' -->
		<module>
		    <label>Renew Update Stack</label>
		    <name>update_online_mechanism</name>
		    <execute>wagon_selfupdate</execute>
		</module>

		<!-- Check whether update to SPx is available -->

		<module>
		    <label>Renew Update Stack</label>
		    <name>suseconfig_after_update</name>
		    <execute>inst_suseconfig</execute>
		</module>

		<!-- Register 'migration-product' to get a new migration URL -->
		<module>
		    <label>Get New Update URL</label>
		    <name>suse_register_before</name>
		    <execute>inst_suse_register</execute>
		</module>

		<!--
		    Use migration URL to Update/Upgrade the running system
		    This will replace the 'migration-product' with 'new-product'
		-->
		<!-- FIXME: reinit sources? We've got some new ... -->
		<module>
		    <label>Update</label>
		    <name>wagon_proposal</name>
		    <execute>inst_proposal</execute>
		    <proposal>wagon_proposal</proposal>
		</module>

		<!-- FIXME: inst_kickoff, inst_rpmcopy? -->

		<module>
		    <label>Update</label>
		    <name>suseconfig_after_update</name>
		    <execute>inst_suseconfig</execute>
		</module>

		<!-- Register the 'new-product' -->
		<module>
		    <label>Registration</label>
		    <name>suse_register_after</name>
		    <execute>inst_suse_register</execute>
		</module>

		<!-- Congratulate, Inform user to reboot etc. -->
		<module>
		    <label>Finished</label>
		    <name>finished</name>
		    <execute>inst_congratulate</execute>
		</module>
	    </modules>
	</workflow>

    </workflows>

</productDefines>
